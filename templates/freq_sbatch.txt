#!/bin/bash
#SBATCH --job-name=JOBNAME
#SBATCH --output=JOBNAME.o
#SBATCH --error=JOBNAME.e
#SBATCH -n 16
#SBATCH -N 1
#SBATCH --mail-user=DEFAULT_EMAIL
#SBATCH --mail-type=END
#SBATCH --parsable

# Script for freq calculation
source_config

gen_slurm_report

#name of molecule and output file
title='JOBNAME'
log=$title.log

# execute job
timeout TIME time g16 $title.com
timeout_status=$?

# termination status (opt successful if termination=1, opt & freq successful if termination=2)
termination=$(grep 'Normal termination' $log | wc -l)

# end of job handling
if [ $timeout_status -eq 124 ]; then            # if the run times out

        # submit restart calc
		bash $FLOW/scripts/restart-freq.sh $title.com
        sbatch $title.sbatch

elif [ $termination -eq 1 ]; then               # if the run terminated successfully
        # move files to completed directory
        mv $title* ../completed/
        cd ../completed/
		to_all_logs $log
        exit 0

else
        # move files to failed_freq directory
        mv $title* ../failed_freq/
        exit 1
fi

